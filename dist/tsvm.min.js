/*! tsvm 03-12-2013 */
define(["require","exports","./kernels/Base","./learning/SequentialMinimalOptimization","./renderers/Canvas","./engine/KernelSupportVectorMachine","./SupportVectorMachine"],function(require,exports,__Kernel__,__Learning__,__Renderer__,__Engine__,__SELF__){function setWidth(width){return _width=width,SELF}function getWidth(){return _width}function setHeight(height){return _height=height,SELF}function getHeight(){return _height}function setComplexity(c){return _teacher.setComplexity(c),SELF}function setScale(scale){return _scale=scale,SELF}function getScale(){return _scale}function setDensity(delta){return _density=delta,SELF}function getDensity(){return _density}function setTeacher(teacher){return _teacher=teacher,SELF}function setKernel(kernel){return kernel instanceof Kernel.Base&&console.log(kernel.getAttributes()),_kernel=kernel,SELF}function getKernel(){return _kernel}function setKernelProperties(properties){return properties.forEach(function(kernelProperty){_kernel[kernelProperty.name]=kernelProperty.value}),SELF}function setKernelProperty(name,value){return _kernel[name]=value,SELF}function train(inputs,labels){if(!_kernel)throw"Please specify a kernel";return _machine||(_machine=new Engine.KernelSupportVectorMachine(_kernel,inputs[0].length)),_teacher||(_teacher=new Learning.SequentialMinimalOptimization(_machine,inputs,labels)),_teacher.run(),SELF}function retrain(){return _teacher.run(),exports.render()}function setRenderer(renderer){return _renderer=renderer,SELF}function render(){return _renderer||(_renderer=new Renderer.Canvas(_teacher)),_renderer.render()}var Kernel=__Kernel__,Learning=__Learning__,Renderer=__Renderer__,Engine=__Engine__,SELF=__SELF__,_kernel=null,_machine=null,_teacher=null,_renderer=null,_width=null,_height=null,_scale=50,_density=2.5;exports.setWidth=setWidth,exports.getWidth=getWidth,exports.setHeight=setHeight,exports.getHeight=getHeight,exports.setComplexity=setComplexity,exports.setScale=setScale,exports.getScale=getScale,exports.setDensity=setDensity,exports.getDensity=getDensity,exports.setTeacher=setTeacher,exports.setKernel=setKernel,exports.getKernel=getKernel,exports.setKernelProperties=setKernelProperties,exports.setKernelProperty=setKernelProperty,exports.train=train,exports.retrain=retrain,exports.setRenderer=setRenderer,exports.render=render}),define(["require","exports"],function(require,exports){var Dictionary=function(){function Dictionary(){this._elements={},this._length=0}return Dictionary.prototype.values=function(){return _.values(this._elements)},Dictionary.prototype.keys=function(){return _.keys(this._elements)},Dictionary.prototype.equals=function(collection){return _.isEqual(this,collection)},Dictionary.prototype.clone=function(){return _.clone(this)},Dictionary.prototype.toString=function(){return"[object Dictionary]"},Dictionary.prototype.add=function(list){this._elements[this._length]=list,this._length++},Dictionary.prototype.get=function(value){return this._filterGet(value).first().value()},Dictionary.prototype.contains=function(value){return this._filterGet(value).size().value()>0},Dictionary.prototype._filterGet=function(value){return _.chain(this._elements).reject(function(list){return list.contains(value)})},Dictionary}();exports.Dictionary=Dictionary}),define(["require","exports"],function(require,exports){var HashSet=function(){function HashSet(elements){"undefined"==typeof elements&&(elements=[]),this._elements=elements}return HashSet.prototype.contains=function(value){return[].indexOf.call(this._elements,value)>-1},HashSet.prototype.add=function(value){this.contains(value)||this._elements.push(value)},HashSet.prototype.get=function(value){var index;return-1!==(index=[].indexOf.call(this._elements,value))?this._elements[index]:void 0},HashSet.prototype.forEach=function(callback){return this._elements.forEach(callback),this},HashSet.prototype.remove=function(value){var index;-1!==(index=[].indexOf.call(this._elements,value))&&this._elements.splice(index,1)},HashSet.prototype.values=function(){return this._elements},HashSet.prototype.toString=function(){return"[object HashSet]"},HashSet}();exports.HashSet=HashSet}),define(["require","exports"],function(require,exports){var List=function(){function List(elements){"undefined"==typeof elements&&(elements=[]);var _this=this;this._elements=[],_.map(elements,function(value){_this.add(value)})}return List.prototype.contains=function(value){return _.contains(this._elements,value)},List.prototype.add=function(value){this._elements.push(value)},List.prototype.remove=function(value){this._elements=_.without(this._elements,value)},List.prototype.count=function(){return _.size(this._elements)},List.prototype.clear=function(){this._elements=[]},List.prototype.toString=function(){return"[object List]"},List}();exports.List=List}),define(["require","exports","../utils/Helpers"],function(require,exports,__Util__){var Util=__Util__,Tuple=function(){function Tuple(components){this._components=components}return Tuple.create=function(){for(var args=[],_i=0;_i<arguments.length-0;_i++)args[_i]=arguments[_i+0];return Util.arrayPopulate(args.length,function(){return args.splice(0,1)})},Tuple.prototype.get=function(){return this._components},Tuple.prototype.count=function(){return this._components.length},Tuple}();exports.Tuple=Tuple});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./SupportVectorMachine"],function(require,exports,__Engine__){var Engine=__Engine__,KernelSupportVectorMachine=function(_super){function KernelSupportVectorMachine(kernel,inputs){if("undefined"==typeof kernel&&(kernel=null),"undefined"==typeof inputs&&(inputs=0),_super.call(this,inputs),null===kernel)throw new Error("No kernel specified. Please select a kernel to use.");this.setKernel(kernel)}return __extends(KernelSupportVectorMachine,_super),KernelSupportVectorMachine.prototype.setKernel=function(kernel){this.kernel=kernel},KernelSupportVectorMachine.prototype.getKernel=function(){return this.kernel},KernelSupportVectorMachine.prototype.compute=function(inputs){var output=this.getThreshold();if(this.isCompact())for(var i=0;i<this.weights.length;i++)output+=this.getWeight(i)*inputs[i];else for(var i=0;i<this.supportVectors.length;i++)output+=this.getWeight(i)*this.kernel.run(this.getSupportVector(i),inputs);return!isNaN(output)&&output>=0?1:-1},KernelSupportVectorMachine}(Engine.SupportVectorMachine);exports.KernelSupportVectorMachine=KernelSupportVectorMachine}),define(["require","exports"],function(require,exports){var SupportVectorMachine=function(){function SupportVectorMachine(inputs){this.inputCount=inputs}return SupportVectorMachine.prototype.getInputCount=function(){return this.inputCount},SupportVectorMachine.prototype.isProbabilistic=function(){return!1},SupportVectorMachine.prototype.isCompact=function(){return null===this.supportVectors},SupportVectorMachine.prototype.getSupportVectors=function(){return this.supportVectors},SupportVectorMachine.prototype.getSupportVector=function(index){return this.supportVectors[index]},SupportVectorMachine.prototype.setSupportVectors=function(value){this.supportVectors=value},SupportVectorMachine.prototype.setSupportVector=function(index,value){this.supportVectors[index]=value},SupportVectorMachine.prototype.setWeight=function(index,value){this.weights[index]=value},SupportVectorMachine.prototype.getWeight=function(index){return this.weights[index]},SupportVectorMachine.prototype.setWeights=function(value){this.weights=value},SupportVectorMachine.prototype.getWeights=function(){return this.weights},SupportVectorMachine.prototype.setThreshold=function(value){this.threshold=value},SupportVectorMachine.prototype.getThreshold=function(){return this.threshold},SupportVectorMachine.prototype.compute=function(inputs,output){if("undefined"==typeof output&&(output=0),output=this.threshold,null===this.supportVectors)for(var i=0;i<this.weights.length;i++)output+=this.weights[i]*inputs[i];else for(var i=0;i<this.supportVectors.length;i++){for(var sum=0,j=0;j<inputs.length;j++)sum+=this.supportVectors[i][j]*inputs[j];output+=this.weights[i]*sum}return!isNaN(output)&&output>=0?1:-1},SupportVectorMachine.prototype.getKernel=function(){return new SVM.Kernels.LinearKernel},SupportVectorMachine.prototype.toJSON=function(){return JSON.stringify({supportVectors:this.getSupportVectors(),weights:this.getWeights(),inputCount:this.getInputCount(),threshold:this.getThreshold()})},SupportVectorMachine}();exports.SupportVectorMachine=SupportVectorMachine}),define(["require","exports","underscore"],function(require,exports,_____){var _=_____,PropertyType=function(){function PropertyType(){}return PropertyType.NUMBER="number",PropertyType.BOOLEAN="boolean",PropertyType.UNDEFINED="undefined",PropertyType}();exports.PropertyType=PropertyType;var Base=function(){function Base(){}return Base.prototype.getAttributes=function(){return Object.keys(this.getAttributeBy("name"))},Base.prototype.getAttribute=function(name){var attribute=this.getAttributeBy("name");return name in attribute?attribute[name]:null},Base.prototype.getAttributeType=function(name){return this.getAttribute(name).type||void name},Base.prototype.getAttributeBy=function(prop){return _.indexBy(this.attributes,prop)},Base}();exports.Base=Base});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Bessel=function(_super){function Bessel(sigma,order){"undefined"==typeof sigma&&(sigma=1),"undefined"==typeof order&&(order=1),_super.call(this),this.attributes=[{name:"order",type:Kernel.PropertyType.NUMBER,writable:!0},{name:"sigma",type:Kernel.PropertyType.NUMBER,writable:!0}],this.sigma=sigma,this.order=order,this.baseBessel=new BesselHelper}return __extends(Bessel,_super),Object.defineProperty(Bessel.prototype,"sigma",{get:function(){return this._sigma},set:function(value){this._sigma=value},enumerable:!0,configurable:!0}),Object.defineProperty(Bessel.prototype,"order",{get:function(){return this._order},set:function(value){this._order=value},enumerable:!0,configurable:!0}),Bessel.prototype.run=function(x,y){for(var norm=0,i=0;i<x.length;i++){var d=x[i]-y[i];norm+=d*d}return norm=Math.sqrt(norm),this.baseBessel.J(this.order,this.sigma*norm)/Math.pow(norm,-norm*this.order)},Bessel}(Kernel.Base);exports.Bessel=Bessel;var BesselHelper=function(){function BesselHelper(){}return BesselHelper.prototype.J0=function(x){var ax=Math.abs(x);if(8>ax){var y=x*x,ans1=57568490574+y*(-13362590354+y*(651619640.7+y*(-11214424.18+y*(77392.33017+-184.9052456*y)))),ans2=57568490411+y*(1029532985+y*(9494680.718+y*(59272.64853+y*(267.8532712+1*y))));return ans1/ans2}var z=8/ax,y=z*z,xx=ax-.785398164,ans1=1+y*(-.001098628627+y*(2734510407e-14+y*(-2073370639e-15+2.093887211e-7*y))),ans2=-.01562499995+y*(.0001430488765+y*(-6911147651e-15+y*(7.621095161e-7-9.34935152e-8*y)));return Math.sqrt(.636619772/ax)*(Math.cos(xx)*ans1-z*Math.sin(xx)*ans2)},BesselHelper.prototype.J1=function(x){var y,ans1,ans2,ax=Math.abs(x);if(8>ax)return y=x*x,ans1=x*(72362614232+y*(-7895059235+y*(242396853.1+y*(-2972611.439+y*(15704.4826+-30.16036606*y))))),ans2=144725228442+y*(2300535178+y*(18583304.74+y*(99447.43394+y*(376.9991397+1*y)))),ans1/ans2;var z=8/ax,xx=ax-2.356194491;y=z*z,ans1=1+y*(.00183105+y*(-3516396496e-14+y*(2457520174e-15+-2.40337019e-7*y))),ans2=.04687499995+y*(-.0002002690873+y*(8449199096e-15+y*(-8.8228987e-7+1.05787412e-7*y)));var ans=Math.sqrt(.636619772/ax)*(Math.cos(xx)*ans1-z*Math.sin(xx)*ans2);return 0>x&&(ans=-ans),ans},BesselHelper.prototype.J=function(n,x){var j,m,ax,bj,bjm,bjp,sum,tox,ans,jsum,ACC=40,BIGNO=1e10,BIGNI=1e-10;if(0==n)return this.J0(x);if(1==n)return this.J1(x);if(ax=Math.abs(x),0==ax)return 0;if(ax>n){for(tox=2/ax,bjm=this.J0(ax),bj=this.J1(ax),j=1;n>j;j++)bjp=j*tox*bj-bjm,bjm=bj,bj=bjp;ans=bj}else{for(tox=2/ax,m=2*((n+Math.sqrt(ACC*n))/2),jsum=!1,bjp=ans=sum=0,bj=1,j=m;j>0;j--)bjm=j*tox*bj-bjp,bjp=bj,bj=bjm,Math.abs(bj)>BIGNO&&(bj*=BIGNI,bjp*=BIGNI,ans*=BIGNI,sum*=BIGNI),jsum&&(sum+=bj),jsum=!jsum,j==n&&(ans=bjp);sum=2*sum-bj,ans/=sum}return 0>x&&n%2==1?-ans:ans},BesselHelper}()});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Cauchy=function(_super){function Cauchy(sigma){"undefined"==typeof sigma&&(sigma=1),_super.call(this),this.attributes=[{name:"sigma",type:Kernel.PropertyType.NUMBER,writable:!0}],this.sigma=sigma}return __extends(Cauchy,_super),Object.defineProperty(Cauchy.prototype,"sigma",{get:function(){return this._sigma},set:function(value){this._sigma=value},enumerable:!0,configurable:!0}),Cauchy.prototype.run=function(x,y){if(x==y)return 1;for(var norm=0,i=0;i<x.length;i++){var d=x[i]-y[i];norm+=d*d}return 1/(1+norm/this.sigma)},Cauchy}(Kernel.Base);exports.Cauchy=Cauchy});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Gaussian=function(_super){function Gaussian(sigma){"undefined"==typeof sigma&&(sigma=1),_super.call(this),this.sigma=sigma}return __extends(Gaussian,_super),Object.defineProperty(Gaussian.prototype,"gamma",{get:function(){return this._gamma},set:function(value){this._sigma=Math.sqrt(1/(2*value)),this._gamma=value},enumerable:!0,configurable:!0}),Object.defineProperty(Gaussian.prototype,"sigma",{get:function(){return this._sigma},set:function(value){this._sigma=Math.sqrt(value),this._gamma=1/(2*value*value)},enumerable:!0,configurable:!0}),Gaussian.prototype.run=function(x,y){if(x===y)return 1;for(var d,norm=0,i=0;i<x.length;i++)d=x[i]-y[i],norm+=d*d;return Math.exp(-this.gamma*norm)},Gaussian.prototype.distance=function(x,y){if(typeof x===Kernel.PropertyType.NUMBER)return 1/-this.gamma*Math.log(1-.5*x);if(x===y)return 0;for(var d,norm=0,i=0;i<x.length;i++)d=x[i]-y[i],norm+=d*d;return 1/-this.gamma*Math.log(1-.5*norm)},Gaussian.prototype.sigmaSquared=function(value){return"undefined"==typeof value&&(value=null),value?(this.sigma=Math.sqrt(value),this.gamma=1/(2*value),void 0):this.sigma*this.sigma},Gaussian}(Kernel.Base);exports.Gaussian=Gaussian});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,HistogramIntersection=function(_super){function HistogramIntersection(alpha,beta){"undefined"==typeof alpha&&(alpha=1),"undefined"==typeof beta&&(beta=1),_super.call(this),this.alpha=alpha,this.beta=beta}return __extends(HistogramIntersection,_super),Object.defineProperty(HistogramIntersection.prototype,"alpha",{get:function(){return this._alpha},set:function(value){this._alpha=value},enumerable:!0,configurable:!0}),Object.defineProperty(HistogramIntersection.prototype,"beta",{get:function(){return this._beta},set:function(value){this._beta=value},enumerable:!0,configurable:!0}),HistogramIntersection.prototype.run=function(x,y){for(var sum=0,i=0;i<x.length;i++)sum+=Math.min(Math.pow(Math.abs(x[i]),this.alpha),Math.pow(Math.abs(y[i]),this.beta));return sum},HistogramIntersection}(Kernel.Base);exports.HistogramIntersection=HistogramIntersection});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Laplacian=function(_super){function Laplacian(gamma,sigma){"undefined"==typeof gamma&&(gamma=1),"undefined"==typeof sigma&&(sigma=1),_super.call(this),this.gamma=gamma,this.sigma=sigma}return __extends(Laplacian,_super),Object.defineProperty(Laplacian.prototype,"gamma",{get:function(){return this._gamma},set:function(value){this._gamma=value},enumerable:!0,configurable:!0}),Object.defineProperty(Laplacian.prototype,"sigma",{get:function(){return this._sigma},set:function(value){this._sigma=value},enumerable:!0,configurable:!0}),Laplacian.prototype.run=function(x,y){if(x==y)return 1;for(var d,norm=0,i=0;i<x.length;i++)d=x[i]-y[i],norm+=d*d;return norm=Math.sqrt(norm),Math.exp(-this.gamma*norm)},Laplacian.prototype.distance=function(x,y){if(x==y)return 0;for(var d,norm=0,i=0;i<x.length;i++)d=x[i]-y[i],norm+=d*d;return norm=Math.sqrt(norm),1/-this.gamma*Math.log(1-.5*norm)},Laplacian}(Kernel.Base);exports.Laplacian=Laplacian});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Linear=function(_super){function Linear(constant){"undefined"==typeof constant&&(constant=1),_super.call(this),this.attributes=[{name:"constant",type:Kernel.PropertyType.NUMBER,writable:!0}],this.constant=constant}return __extends(Linear,_super),Object.defineProperty(Linear.prototype,"constant",{get:function(){return this._constant},set:function(value){this._constant=value},enumerable:!0,configurable:!0}),Linear.prototype.run=function(x,y){for(var sum=this.constant,i=0;i<x.length;i++)sum+=x[i]*y[i];return sum},Linear.prototype.distance=function(x,y){return this.run(x,x)+this.run(y,y)-2*this.run(x,y)},Linear}(Kernel.Base);exports.Linear=Linear});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Polynominal=function(_super){function Polynominal(degree,constant){"undefined"==typeof degree&&(degree=1),"undefined"==typeof constant&&(constant=1),_super.call(this),this.attributes=[{name:"degree",type:Kernel.PropertyType.NUMBER,writable:!0},{name:"constant",type:Kernel.PropertyType.NUMBER,writable:!0}],this.degree=degree,this.constant=constant}return __extends(Polynominal,_super),Object.defineProperty(Polynominal.prototype,"degree",{get:function(){return this._degree},set:function(value){this._degree=value},enumerable:!0,configurable:!0}),Object.defineProperty(Polynominal.prototype,"constant",{get:function(){return this._constant},set:function(value){this._constant=value},enumerable:!0,configurable:!0}),Polynominal.prototype.run=function(x,y){for(var sum=this.constant,i=0;i<x.length;i++)sum+=x[i]*y[i];return Math.pow(sum,this.degree)},Polynominal.prototype.distance=function(x,y){var q=1/this.degree;return Math.pow(this.run(x,x),q)+Math.pow(this.run(y,y),q)-2*Math.pow(this.run(x,y),q)},Polynominal}(Kernel.Base);exports.Polynominal=Polynominal});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Sigmoid=function(_super){function Sigmoid(alpha,constant){"undefined"==typeof alpha&&(alpha=.01),"undefined"==typeof constant&&(constant=-Math.E),_super.call(this),this.alpha=alpha,this.constant=constant}return __extends(Sigmoid,_super),Object.defineProperty(Sigmoid.prototype,"alpha",{get:function(){return this._alpha},set:function(value){this._alpha=value},enumerable:!0,configurable:!0}),Object.defineProperty(Sigmoid.prototype,"constant",{get:function(){return this._constant},set:function(value){this._constant=value},enumerable:!0,configurable:!0}),Sigmoid.prototype.run=function(x,y){for(var sum=0,i=0;i<x.length;i++)sum+=x[i]*y[i];return this.tanh(this.alpha*sum+this.constant)},Sigmoid.prototype.tanh=function(arg){var pos=Math.exp(arg),neg=Math.exp(-arg);return(pos-neg)/(pos+neg)},Sigmoid}(Kernel.Base);exports.Sigmoid=Sigmoid});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Spherical=function(_super){function Spherical(sigma){"undefined"==typeof sigma&&(sigma=1),_super.call(this),this.sigma=sigma}return __extends(Spherical,_super),Object.defineProperty(Spherical.prototype,"sigma",{get:function(){return this._sigma},set:function(value){this._sigma=value},enumerable:!0,configurable:!0}),Spherical.prototype.run=function(x,y){for(var norm=0,i=0;i<x.length;i++){var d=x[i]-y[i];norm+=d*d}return norm=Math.sqrt(norm),norm>=this.sigma?0:(norm/=this.sigma,1-1.5*norm+.5*norm*norm*norm)},Spherical}(Kernel.Base);exports.Spherical=Spherical});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,SplineKernel=function(_super){function SplineKernel(){_super.call(this)}return __extends(SplineKernel,_super),SplineKernel.prototype.run=function(x,y){for(var k=1,i=0;i<x.length;i++){var min=Math.min(x[i],y[i]),xy=x[i]*y[i];k*=1+xy+xy*min-(x[i]+y[i])/2*min*min+min*min*min/3}return k},SplineKernel}(Kernel.Base);exports.SplineKernel=SplineKernel});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,SquaredSinc=function(_super){function SquaredSinc(gamma){"undefined"==typeof gamma&&(gamma=1),_super.call(this),this.gamma=gamma}return __extends(SquaredSinc,_super),Object.defineProperty(SquaredSinc.prototype,"gamma",{get:function(){return this._gamma},set:function(value){this._gamma=value},enumerable:!0,configurable:!0}),SquaredSinc.prototype.run=function(x,y){for(var d,norm=0,i=0;i<x.length;i++)d=x[i]-y[i],norm+=d*d;var num=this.gamma*Math.sqrt(norm),den=this.gamma*this.gamma*norm;return Math.sin(num)/den},SquaredSinc}(Kernel.Base);exports.SquaredSinc=SquaredSinc});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,SymmetricTriangle=function(_super){function SymmetricTriangle(gamma){"undefined"==typeof gamma&&(gamma=1),_super.call(this),this.gamma=gamma}return __extends(SymmetricTriangle,_super),Object.defineProperty(SymmetricTriangle.prototype,"gamma",{get:function(){return this._gamma},set:function(value){this._gamma=value},enumerable:!0,configurable:!0}),SymmetricTriangle.prototype.run=function(x,y){for(var d,norm=0,i=0;i<x.length;i++)d=x[i]-y[i],norm+=d*d;var z=1-this.gamma*Math.sqrt(norm);return z>0?z:0},SymmetricTriangle}(Kernel.Base);exports.SymmetricTriangle=SymmetricTriangle});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,TStudent=function(_super){function TStudent(degree){"undefined"==typeof degree&&(degree=1),_super.call(this),this.degree=degree}return __extends(TStudent,_super),Object.defineProperty(TStudent.prototype,"degree",{get:function(){return this._degree},set:function(value){this._degree=value},enumerable:!0,configurable:!0}),TStudent.prototype.run=function(x,y){for(var norm=0,i=0;i<x.length;i++){var d=x[i]-y[i];norm+=d*d}return norm=Math.sqrt(norm),1/(1+Math.pow(norm,this.degree))},TStudent}(Kernel.Base);exports.TStudent=TStudent});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Tensor=function(_super){function Tensor(kernels){_super.call(this),this._kernels=kernels}return __extends(Tensor,_super),Tensor.prototype.run=function(x,y){for(var product=1,i=0;i<this._kernels.length;i++)product*=this._kernels[i].run(x,y);return product},Tensor}(Kernel.Base);exports.Tensor=Tensor});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Wave=function(_super){function Wave(sigma){"undefined"==typeof sigma&&(sigma=1),_super.call(this),this.sigma=sigma}return __extends(Wave,_super),Object.defineProperty(Wave.prototype,"sigma",{get:function(){return this._sigma},set:function(value){this._sigma=value},enumerable:!0,configurable:!0}),Wave.prototype.run=function(x,y){for(var norm=0,i=0;i<x.length;i++){var d=x[i]-y[i];norm+=d*d}return 0==this.sigma||0==norm?0:this.sigma/norm*Math.sin(norm/this.sigma)},Wave}(Kernel.Base);exports.Wave=Wave});var __extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __};define(["require","exports","./Base"],function(require,exports,__Kernel__){var Kernel=__Kernel__,Wavelet=function(_super){function Wavelet(dialation,translation,invariant){"undefined"==typeof dialation&&(dialation=1),"undefined"==typeof translation&&(translation=1),"undefined"==typeof invariant&&(invariant=!1),_super.call(this),this.dialation=dialation,this.translation=translation,this.invariant=invariant}return __extends(Wavelet,_super),Object.defineProperty(Wavelet.prototype,"dialation",{get:function(){return this._dialation},set:function(value){this._dialation=value},enumerable:!0,configurable:!0}),Object.defineProperty(Wavelet.prototype,"translation",{get:function(){return this._translation},set:function(value){this._translation=value},enumerable:!0,configurable:!0}),Object.defineProperty(Wavelet.prototype,"invariant",{get:function(){return this._invariant},set:function(value){this._invariant=value},enumerable:!0,configurable:!0}),Wavelet.prototype.run=function(x,y){var prod=1;if(this.invariant)for(var i=0;i<x.length;i++)prod*=this.mother((x[i]-this.translation)/this.dialation)*this.mother((y[i]-this.translation)/this.dialation);else for(var i=0;i<x.length;i++)prod*=this.mother(x[i]-y[i]/this.dialation);return prod},Wavelet.prototype.mother=function(x){return Math.cos(1.75*x)*Math.exp(-(x*x)/2)},Wavelet}(Kernel.Base);exports.Wavelet=Wavelet}),define(["require","exports","../base/HashSet"],function(require,exports,__Generic__){var Generic=__Generic__,SequentialMinimalOptimization=function(){function SequentialMinimalOptimization(machine,inputs,outputs){if("undefined"==typeof machine&&(machine=null),"undefined"==typeof inputs&&(inputs=null),"undefined"==typeof outputs&&(outputs=null),this.cost=1,this.tolerance=.001,this.epsilon=.001,this.roundingEpsilon=1e-12,null===machine)throw"Machine is null";if(null===inputs)throw"Inputs is null";if(null===outputs)throw"Outputs is null";if(inputs.length!==outputs.length)throw"The number of inputs and outputs does not match. "+inputs.length+" != "+outputs.length;if(machine.getInputCount()>0)for(var i=0;i<inputs.length;i++)if(inputs[i].length!==machine.getInputCount())throw"The size of the input vectors does not match the expected number of inputs of the machine";this.machine=machine,this.kernel=machine.getKernel(),this.inputs=inputs,this.outputs=outputs}return SequentialMinimalOptimization.prototype.getComplexity=function(){return this.cost},SequentialMinimalOptimization.prototype.setComplexity=function(value){if(0>=value)throw"Out of range";this.cost=value},SequentialMinimalOptimization.prototype.setEpsilon=function(value){if(0>=value)throw"Out of range";this.epsilon=value},SequentialMinimalOptimization.prototype.getEpsilon=function(){return this.epsilon},SequentialMinimalOptimization.prototype.setTolerance=function(value){if(0>=value)throw"Out of range";this.tolerance=value},SequentialMinimalOptimization.prototype.getTolerance=function(){return this.tolerance},SequentialMinimalOptimization.prototype.run=function(computeError){var N=this.inputs.length;this.alphaA=new Float64Array(N),this.alphaB=new Float64Array(N),this.errors=new Float64Array(N),this.I0=new Generic.HashSet,this.I1=new Generic.HashSet,this.I2=new Generic.HashSet,this.I3=new Generic.HashSet;for(var i=0;N>i;i++)this.I1.add(i);this.biasUpperIndex=0,this.biasLowerIndex=0,this.biasUpper=this.outputs[0]+this.getEpsilon(),this.biasLower=this.outputs[0]-this.getEpsilon();for(var numChanged=0,examineAll=!0;numChanged>0||examineAll;){if(numChanged=0,examineAll)for(var i=0;N>i;i++)numChanged+=this.examineExample(i);else for(var i=0;N>i;i++)if((0<this.alphaA[i]&&this.alphaA[i]<this.cost||0<this.alphaB[i]&&this.alphaB[i]<this.cost)&&(numChanged+=this.examineExample(i),this.biasUpper>this.biasLower-2*this.getTolerance())){numChanged=0;break}examineAll?examineAll=!1:0===numChanged&&(examineAll=!0)}for(var list=[],i=0;N>i;i++)(this.alphaA[i]>0||this.alphaB[i]>0)&&list.push(i);this.machine.setSupportVectors(new Array(list.length)),this.machine.setWeights(new Array(list.length));for(var i=0;i<list.length;i++){var j=list[i];this.machine.setSupportVector(i,this.inputs[j]),this.machine.setWeight(i,this.alphaA[j]-this.alphaB[j])}return this.machine.setThreshold((this.biasLower+this.biasUpper)/2),computeError?this.computeError(this.inputs,this.outputs):0},SequentialMinimalOptimization.prototype.examineExample=function(i2){var alpha2A=this.alphaA[i2],alpha2B=this.alphaB[i2],e2=0,epsilon=this.getEpsilon(),tolerance=this.getTolerance();this.I0.contains(i2)?e2=this.errors[i2]:(this.errors[i2]=e2=this.outputs[i2]-this.compute(this.inputs[i2]),this.I1.contains(i2)?e2+epsilon<this.biasUpper?(this.biasUpper=e2+epsilon,this.biasUpperIndex=i2):e2-epsilon>this.biasLower&&(this.biasLower=e2-epsilon,this.biasLowerIndex=i2):this.I2.contains(i2)&&e2+epsilon>this.biasLower?(this.biasLower=e2+epsilon,this.biasLowerIndex=i2):this.I3.contains(i2)&&e2-epsilon<this.biasUpper&&(this.biasUpper=e2-epsilon,this.biasUpperIndex=i2));var i1=-1,optimal=!0;if(this.I0.contains(i2))alpha2A>0&&alpha2A<this.cost?this.biasLower-(e2-epsilon)>2*tolerance?(optimal=!1,i1=this.biasLowerIndex,e2-epsilon-this.biasUpper>this.biasLower-(e2-epsilon)&&(i1=this.biasUpperIndex)):e2-epsilon-this.biasUpper>2*tolerance&&(optimal=!1,i1=this.biasUpperIndex,this.biasLower-(e2-epsilon)>e2-epsilon-this.biasUpper&&(i1=this.biasLowerIndex)):alpha2B>0&&alpha2B<this.cost&&(this.biasLower-(e2-epsilon)>2*tolerance?(optimal=!1,i1=this.biasLowerIndex,e2+epsilon-this.biasUpper>this.biasLower-(e2+epsilon)&&(i1=this.biasUpperIndex)):e2+epsilon-this.biasUpper>2*tolerance&&(optimal=!1,i1=this.biasUpperIndex,this.biasLower-(e2+epsilon)>e2+epsilon-this.biasUpper&&(i1=this.biasLowerIndex)));else if(this.I1.contains(i2))this.biasLower-(e2+epsilon)>2*tolerance?(optimal=!1,i1=this.biasLowerIndex,e2+epsilon-this.biasUpper>this.biasLower-(e2+epsilon)&&(i1=this.biasUpperIndex)):e2-epsilon-this.biasUpper>2*tolerance&&(optimal=!1,i1=this.biasUpperIndex,this.biasLower-(e2-epsilon)>e2-epsilon-this.biasUpper&&(i1=this.biasLowerIndex));else if(this.I2.contains(i2))e2+epsilon-this.biasUpper>2*tolerance&&(optimal=!1,i1=this.biasUpperIndex);else{if(!this.I3.contains(i2))throw new Error("BOM! I missed");
this.biasLower-(e2-epsilon)>2*tolerance&&(optimal=!1,i1=this.biasLowerIndex)}return optimal?0:this.takeStep(i1,i2)?1:0},SequentialMinimalOptimization.prototype.computeError=function(inputs,expectedOutputs){for(var sum=0,i=0;i<inputs.length;i++){var s=this.machine.compute(inputs[i])-expectedOutputs[i];sum+=s*s}return s},SequentialMinimalOptimization.prototype.compute=function(point){for(var sum=0,j=0;j<this.alphaA.length;j++)sum+=(this.alphaA[j]-this.alphaB[j])*this.kernel.run(point,this.inputs[j]);return sum},SequentialMinimalOptimization.prototype.takeStep=function(i1,i2){var _this=this;if(i1==i2)return!1;var alpha1a=this.alphaA[i1],alpha1b=this.alphaB[i1],alpha2a=this.alphaA[i2],alpha2b=this.alphaB[i2],e1=this.errors[i1],e2=this.errors[i2],delta=e1-e2,epsilon=this.getEpsilon(),k11=this.kernel.run(this.inputs[i1],this.inputs[i1]),k12=this.kernel.run(this.inputs[i1],this.inputs[i2]),k22=this.kernel.run(this.inputs[i2],this.inputs[i2]),eta=k11+k22-2*k12,gamma=alpha1a-alpha1b+alpha2a-alpha2b;0>eta&&(eta=0);for(var L,H,a1,a2,case1=!1,case2=!1,case3=!1,case4=!1,changed=!1,finished=!1;!finished;){if(!case1&&(alpha1a>0||0==alpha1b&&delta>0)&&(alpha2a>0||0==alpha2b&&0>delta)){if(L=Math.max(0,gamma-this.cost),H=Math.min(this.cost,gamma),H>L){if(eta>0)a2=alpha2a-delta/eta,a2>H?a2=H:L>a2&&(a2=L);else{var Lobj=-L*delta,Hobj=-H*delta;a2=Lobj>Hobj?L:H}a1=alpha1a-(a2-alpha2a),(Math.abs(a1-alpha1a)>this.roundingEpsilon||Math.abs(a2-alpha2a)>this.roundingEpsilon)&&(alpha1a=a1,alpha2a=a2,changed=!0)}else finished=!0;case1=!0}else if(!case2&&(alpha1a>0||0==alpha1b&&delta>2*epsilon)&&(alpha2b>0||0==alpha2a&&delta>2*epsilon)){if(L=Math.max(0,-gamma),H=Math.min(this.cost,-gamma+this.cost),H>L){if(eta>0)a2=alpha2b+(delta-2*epsilon)/eta,a2>H?a2=H:L>a2&&(a2=L);else{var Lobj=L*(-2*epsilon+delta),Hobj=H*(-2*epsilon+delta);a2=Lobj>Hobj?L:H}a1=alpha1a+(a2-alpha2b),(Math.abs(a1-alpha1a)>this.roundingEpsilon||Math.abs(a2-alpha2b)>this.roundingEpsilon)&&(alpha1a=a1,alpha2b=a2,changed=!0)}else finished=!0;case2=!0}else if(!case3&&(alpha1b>0||0==alpha1a&&-2*epsilon>delta)&&(alpha2a>0||0==alpha2b&&-2*epsilon>delta)){if(L=Math.max(0,gamma),H=Math.min(this.cost,this.cost+gamma),H>L){if(eta>0)a2=alpha2a-(delta+2*epsilon)/eta,a2>H?a2=H:L>a2&&(a2=L);else{var Lobj=-L*(2*epsilon+delta),Hobj=-H*(2*epsilon+delta);a2=Lobj>Hobj?L:H}a1=alpha1b+(a2-alpha2a),(Math.abs(a1-alpha1b)>this.roundingEpsilon||Math.abs(a2-alpha2a)>this.roundingEpsilon)&&(alpha1b=a1,alpha2a=a2,changed=!0)}else finished=!0;case3=!0}else if(!case4&&(alpha1b>0||0==alpha1a&&0>delta)&&(alpha2b>0||0==alpha2a&&delta>0)){if(L=Math.max(0,-gamma-this.cost),H=Math.min(this.cost,-gamma),H>L){if(eta>0)a2=alpha2b+delta/eta,a2>H?a2=H:L>a2&&(a2=L);else{var Lobj=L*delta,Hobj=H*delta;a2=Lobj>Hobj?L:H}a1=alpha1b-(a2-alpha2b),(Math.abs(a1-alpha1b)>this.roundingEpsilon||Math.abs(a2-alpha2b)>this.roundingEpsilon)&&(alpha1b=a1,alpha2b=a2,changed=!0)}else finished=!0;case4=!0}else finished=!0;delta+=eta*(alpha2a-alpha2b-(this.alphaA[i2]-this.alphaB[i2]))}if(!changed)return!1;this.I0.values().forEach(function(i){Number(i)!==Number(i1)&&Number(i)!==Number(i2)&&(_this.errors[i]+=(_this.alphaA[i1]-_this.alphaB[i1]-(alpha1a-alpha1b))*_this.kernel.run(_this.inputs[i1],_this.inputs[i])+(_this.alphaA[i2]-_this.alphaB[i2]-(alpha2a-alpha2b))*_this.kernel.run(_this.inputs[i2],_this.inputs[i]))}),this.errors[i1]+=(this.alphaA[i1]-this.alphaB[i1]-(alpha1a-alpha1b))*k11+(this.alphaA[i2]-this.alphaB[i2]-(alpha2a-alpha2b))*k12,this.errors[i2]+=(this.alphaA[i1]-this.alphaB[i1]-(alpha1a-alpha1b))*k12+(this.alphaA[i2]-this.alphaB[i2]-(alpha2a-alpha2b))*k22;var m_Del=1e-10;if(alpha1a>this.cost-m_Del*this.cost?alpha1a=this.cost:alpha1a<=m_Del*this.cost&&(alpha1a=0),alpha1b>this.cost-m_Del*this.cost?alpha1b=this.cost:alpha1b<=m_Del*this.cost&&(alpha1b=0),alpha2a>this.cost-m_Del*this.cost?alpha2a=this.cost:alpha2a<=m_Del*this.cost&&(alpha2a=0),alpha2b>this.cost-m_Del*this.cost?alpha2b=this.cost:alpha2b<=m_Del*this.cost&&(alpha2b=0),this.alphaA[i1]=alpha1a,this.alphaB[i1]=alpha1b,this.alphaA[i2]=alpha2a,this.alphaB[i2]=alpha2b,alpha1a>0&&alpha1a<this.cost||alpha1b>0&&alpha1b<this.cost?this.I0.add(i1):this.I0.remove(i1),0==alpha1a&&0==alpha1b?this.I1.add(i1):this.I1.remove(i1),0==alpha1a&&alpha1b==this.cost?this.I2.add(i1):this.I2.remove(i1),alpha1a==this.cost&&0==alpha1b?this.I3.add(i1):this.I3.remove(i1),alpha2a>0&&alpha2a<this.cost||alpha2b>0&&alpha2b<this.cost?this.I0.add(i2):this.I0.remove(i2),0==alpha2a&&0==alpha2b?this.I1.add(i2):this.I1.remove(i2),0==alpha2a&&alpha2b==this.cost?this.I2.add(i2):this.I2.remove(i2),alpha2a==this.cost&&0==alpha2b?this.I3.add(i2):this.I3.remove(i2),this.biasLower=-Math.pow(2,32),this.biasUpper=Math.pow(2,32),this.biasLowerIndex=-1,this.biasUpperIndex=-1,this.I0.values().forEach(function(i){0<_this.alphaB[i]&&_this.alphaB[i]<_this.cost&&_this.errors[i]+epsilon>_this.biasLower?(_this.biasLower=_this.errors[i]+epsilon,_this.biasLowerIndex=i):0<_this.alphaA[i]&&_this.alphaA[i]<_this.cost&&_this.errors[i]-epsilon>_this.biasLower&&(_this.biasLower=_this.errors[i]-epsilon,_this.biasLowerIndex=i),0<_this.alphaA[i]&&_this.alphaA[i]<_this.cost&&_this.errors[i]-epsilon<_this.biasUpper?(_this.biasUpper=_this.errors[i]-epsilon,_this.biasUpperIndex=i):0<_this.alphaB[i]&&_this.alphaB[i]<_this.cost&&_this.errors[i]+epsilon<_this.biasUpper&&(_this.biasUpper=_this.errors[i]+epsilon,_this.biasUpperIndex=i)}),this.I0.contains(i1)||(this.I2.contains(i1)&&this.errors[i1]+epsilon>this.biasLower?(this.biasLower=this.errors[i1]+epsilon,this.biasLowerIndex=i1):this.I1.contains(i1)&&this.errors[i1]-epsilon>this.biasLower&&(this.biasLower=this.errors[i1]-epsilon,this.biasLowerIndex=i1),this.I3.contains(i1)&&this.errors[i1]-epsilon<this.biasUpper?(this.biasUpper=this.errors[i1]-epsilon,this.biasUpperIndex=i1):this.I1.contains(i1)&&this.errors[i1]+epsilon<this.biasUpper&&(this.biasUpper=this.errors[i1]+epsilon,this.biasUpperIndex=i1)),this.I0.contains(i2)||(this.I2.contains(i2)&&this.errors[i2]+epsilon>this.biasLower?(this.biasLower=this.errors[i2]+epsilon,this.biasLowerIndex=i2):this.I1.contains(i2)&&this.errors[i2]-epsilon>this.biasLower&&(this.biasLower=this.errors[i2]-epsilon,this.biasLowerIndex=i2),this.I3.contains(i2)&&this.errors[i2]-epsilon<this.biasUpper?(this.biasUpper=this.errors[i2]-epsilon,this.biasUpperIndex=i2):this.I1.contains(i2)&&this.errors[i2]+epsilon<this.biasUpper&&(this.biasUpper=this.errors[i2]+epsilon,this.biasUpperIndex=i2)),-1==this.biasLowerIndex||-1==this.biasUpperIndex)throw new Error("cry cry");return!0},SequentialMinimalOptimization}();exports.SequentialMinimalOptimization=SequentialMinimalOptimization}),define(["require","exports","../kernels/Base","../SupportVectorMachine"],function(require,exports,__Base__,__SVM__){var Base=__Base__,SVM=__SVM__,Canvas=function(){function Canvas(teacher){this.canvas=document.createElement("canvas"),this.canvas.height=SVM.getHeight(),this.canvas.width=SVM.getWidth(),document.body.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.teacher=teacher}return Canvas.prototype.drawBackground=function(matrix,color){var _this=this;return matrix.forEach(function(V){_this.context.fillStyle=color,_this.drawRect(V[0]*SVM.getScale()+SVM.getWidth()/2,V[1]*SVM.getScale()+SVM.getHeight()/2,2+SVM.getDensity(),2+SVM.getDensity())}),this},Canvas.prototype.drawAxis=function(){return this.context.beginPath(),this.context.strokeStyle="rgb(50,50,50)",this.context.lineWidth=1,this.context.moveTo(0,SVM.getHeight()/2),this.context.lineTo(SVM.getWidth(),SVM.getHeight()/2),this.context.moveTo(SVM.getWidth()/2,0),this.context.lineTo(SVM.getWidth()/2,SVM.getHeight()),this.context.stroke(),this},Canvas.prototype.drawMargin=function(){var xs=[-5,5],ys=[0,0];ys[0]=(-this.teacher.biasLower-this.teacher.machine.getWeight(0)*xs[0])/this.teacher.machine.getWeight(1),ys[1]=(-this.teacher.biasLower-this.teacher.machine.getWeight(0)*xs[1])/this.teacher.machine.getWeight(1),this.context.fillStyle="rgb(0,0,0)",this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(xs[0],ys[0]),this.context.lineTo(xs[1],ys[1]),this.context.moveTo(xs[0],ys[0]-1/this.teacher.machine.getWeight(1)),this.context.lineTo(xs[1],ys[1]-1/this.teacher.machine.getWeight(1)),this.context.moveTo(xs[0],ys[0]+1/this.teacher.machine.getWeight(1)),this.context.lineTo(xs[1],ys[1]+1/this.teacher.machine.getWeight(1)),this.context.stroke();for(var i=0;i<this.teacher.inputs.length;i++)if(!(this.teacher.alphaA[i]<.01||this.teacher.alphaB[i]<.01)){1==this.teacher.outputs[i]?(ys[0]=(1-this.teacher.biasLower-this.teacher.machine.getWeight(0)*xs[0])/this.teacher.machine.getWeight(1),ys[1]=(1-this.teacher.biasLower-this.teacher.machine.getWeight(0)*xs[1])/this.teacher.machine.getWeight(1)):(ys[0]=(-1-this.teacher.biasLower-this.teacher.machine.getWeight(0)*xs[0])/this.teacher.machine.getWeight(1),ys[1]=(-1-this.teacher.biasLower-this.teacher.machine.getWeight(0)*xs[1])/this.teacher.machine.getWeight(1));var u=(this.teacher.inputs[i][0]-xs[0])*(xs[1]-xs[0])+(this.teacher.inputs[i][1]-ys[0])*(ys[1]-ys[0])/((xs[0]-xs[1])*(xs[0]-xs[1])+(ys[0]-ys[1])*(ys[0]-ys[1])),xi=xs[0]+u*(xs[1]-xs[0]),yi=ys[0]+u*(ys[1]-ys[0]),mX=this.teacher.inputs[i][0],mY=this.teacher.inputs[i][1];this.context.moveTo(mX,mY),this.context.lineTo(xi,yi)}return this.context.stroke(),this},Canvas.prototype.clearCanvas=function(){return this.context.clearRect(0,0,SVM.getWidth(),SVM.getHeight()),this},Canvas.prototype.render=function(){this.clearCanvas();for(var resultsA=[],resultsB=[],x=0;x<=SVM.getWidth();x+=SVM.getDensity())for(var y=0;y<=SVM.getHeight();y+=SVM.getDensity()){var vector=[(x-SVM.getWidth()/2)/SVM.getScale(),(y-SVM.getHeight()/2)/SVM.getScale()],decision=this.teacher.machine.compute(vector);decision>0?resultsA.push(vector):resultsB.push(vector)}return this.drawBackground(resultsA,"rgb(150,250,150)").drawBackground(resultsB,"rgb(250,150,150)").drawDataPoints().drawAxis().drawStatus(),this},Canvas.prototype.drawDataPoints=function(){this.context.strokeStyle="rgb(0,0,0)";for(var i=0;i<this.teacher.inputs.length;i++){this.context.fillStyle=1==this.teacher.outputs[i]?"rgb(100,200,100)":"rgb(200,100,100)",this.context.lineWidth=this.teacher.alphaA[i]>.01||this.teacher.alphaB[i]>.01?3:1;var posX=this.teacher.inputs[i][0]*SVM.getScale()+SVM.getWidth()/2,posY=this.teacher.inputs[i][1]*SVM.getScale()+SVM.getHeight()/2,radius=Math.floor(3+5*(this.teacher.alphaA[i]+this.teacher.alphaB[i])/this.teacher.getComplexity());this.drawCircle(posX,posY,radius)}return this},Canvas.prototype.drawStatus=function(){var _this=this;this.context.fillStyle="rgb(0,0,0)",this.context.font="12pt open sans";for(var numsupp=0,i=0;i<this.teacher.inputs.length;i++)(this.teacher.alphaA[i]>1e-5||this.teacher.alphaB[i]>1e-5)&&numsupp++;this.context.fillText("Using "+this.teacher.kernel.constructor.name,10,SVM.getHeight()-80);var propertiesString="";return this.teacher.kernel.getAttributes().forEach(function(propertyName){propertiesString.length>0&&(propertiesString+=", ");var property=_this.teacher.kernel.getAttribute(propertyName);propertiesString+=property.type===Base.PropertyType.NUMBER?propertyName+" = "+_this.teacher.kernel[property.name].toPrecision(2):propertyName+" = "+_this.teacher.kernel[property.name].toString()}),this.context.fillText("Kernel properties: "+propertiesString,10,SVM.getHeight()-60),this.context.fillText("Support Vectors: "+numsupp+" / "+this.teacher.inputs.length,10,SVM.getHeight()-40),this.context.fillText("Complexity: "+this.teacher.getComplexity().toPrecision(2),10,SVM.getHeight()-20),this},Canvas.prototype.drawBubble=function(x,y,w,h,radius){var r=x+w,b=y+h;return this.context.beginPath(),this.context.strokeStyle="black",this.context.lineWidth=2,this.context.moveTo(x+radius,y),this.context.lineTo(x+radius/2,y-10),this.context.lineTo(x+2*radius,y),this.context.lineTo(r-radius,y),this.context.quadraticCurveTo(r,y,r,y+radius),this.context.lineTo(r,y+h-radius),this.context.quadraticCurveTo(r,b,r-radius,b),this.context.lineTo(x+radius,b),this.context.quadraticCurveTo(x,b,x,b-radius),this.context.lineTo(x,y+radius),this.context.quadraticCurveTo(x,y,x+radius,y),this.context.stroke(),this},Canvas.prototype.drawRect=function(x,y,w,h,stroke){return"undefined"==typeof stroke&&(stroke=!1),this.context.beginPath(),this.context.rect(x,y,w,h),this.context.closePath(),this.context.fill(),stroke&&this.context.stroke(),this},Canvas.prototype.drawCircle=function(x,y,r){return this.context.beginPath(),this.context.arc(x,y,r,0,2*Math.PI,!0),this.context.closePath(),this.context.stroke(),this.context.fill(),this},Canvas}();exports.Canvas=Canvas});var SVM;!function(SVM){!function(Renderer){var D3=function(){function D3(options){this.smo=options.smo,this.width=720,this.height=720}return D3.prototype.render=function(){var margin={top:20,right:20,bottom:30,left:40},width=this.width-margin.left-margin.right,height=this.height-margin.top-margin.bottom;return this.x=d3.scale.linear().range([0,width]),this.y=d3.scale.linear().range([height,0]),this.color=d3.scale.category10(),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.y).orient("left"),this.svg=d3.select("body").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").call(this.yAxis),this.x.domain(d3.extent(this.smo.inputs,function(d){return d[0]})).nice(),this.y.domain(d3.extent(this.smo.inputs,function(d){return d[1]})).nice(),this.paintDataPoints(),this},D3.prototype.paintDataPoints=function(){var _this=this;this.svg.selectAll(".dot").data(this.smo.inputs).enter().append("circle").attr("class","dot").attr("r",function(){return 3.5}).attr("cx",function(d){return _this.x(d[0])}).attr("cy",function(d){return _this.y(d[1])}).style("fill",function(d,i){return-1===_this.smo.outputs[i]?"red":"green"});var legend=this.svg.selectAll(".legend").data(this.color.domain()).enter().append("g").attr("class","legend").attr("transform",function(d,i){return"translate(0,"+20*i+")"});legend.append("rect").attr("x",this.width-18).attr("width",18).attr("height",18).style("fill",this.color),legend.append("text").attr("x",this.width-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(d){return d})},D3.prototype.paintDecisionBackground=function(){var _this=this,vertices=d3.range(5).map(function(){return[Math.random()*_this.width,Math.random()*_this.height]}),voronoi=d3.geom.voronoi().clipExtent([[0,0],[this.width,this.height]]),path=this.svg.append("g").selectAll("path");path=path.data(voronoi(vertices).map(function(d){return"M"+d.join("L")+"Z"}),String),path.exit().remove(),path.enter().append("path").attr("class",function(d,i){return"q"+i%9+"-9"}).attr("d",String),path.order()},D3}();Renderer.D3=D3}(SVM.Renderer||(SVM.Renderer={}));SVM.Renderer}(SVM||(SVM={}));var SVM;!function(SVM){!function(Renderer){var Video=function(){function Video(teacher){this.video=document.createElement("video"),this.video.height=SVM.getHeight(),this.video.width=SVM.getWidth(),document.body.appendChild(this.video),this.context=this.video.getContext("2d"),this.teacher=teacher}return Video.prototype.render=function(){for(var resultsA=[],resultsB=[],x=0;x<=SVM.getWidth();x+=SVM.getDensity())for(var y=0;y<=SVM.getHeight();y+=SVM.getDensity()){var vector=[(x-SVM.getWidth()/2)/SVM.getScale(),(y-SVM.getHeight()/2)/SVM.getScale()],decision=this.teacher.machine.compute(vector);decision>0?resultsA.push(vector):resultsB.push(vector)}return this.drawBackground(resultsA,"rgb(150,250,150)").drawBackground(resultsB,"rgb(250,150,150)").drawDataPoints().drawAxis().drawStatus(),this},Video.prototype.drawDataPoints=function(){this.context.strokeStyle="rgb(0,0,0)";for(var i=0;i<this.teacher.inputs.length;i++){this.context.fillStyle=1==this.teacher.outputs[i]?"rgb(100,200,100)":"rgb(200,100,100)",this.context.lineWidth=this.teacher.alphaA[i]>.01||this.teacher.alphaB[i]>.01?3:1;var posX=this.teacher.inputs[i][0]*SVM.getScale()+SVM.getWidth()/2,posY=this.teacher.inputs[i][1]*SVM.getScale()+SVM.getHeight()/2,radius=Math.floor(3+5*(this.teacher.alphaA[i]+this.teacher.alphaB[i])/this.teacher.getComplexity());this.drawCircle(posX,posY,radius)}return this},Video.prototype.drawStatus=function(){var _this=this;this.context.fillStyle="rgb(0,0,0)",this.context.font="12pt open sans";for(var numsupp=0,i=0;i<this.teacher.inputs.length;i++)(this.teacher.alphaA[i]>1e-5||this.teacher.alphaB[i]>1e-5)&&numsupp++;this.context.fillText("Using "+this.teacher.kernel.constructor.name,10,SVM.getHeight()-80);var propertiesString="";return this.teacher.kernel.getProperties().forEach(function(propertyName){propertiesString.length>0&&(propertiesString+=", ");var property=_this.teacher.kernel.getProperty(propertyName);propertiesString+=propertyName+" = "+property.value.toPrecision(2)}),this.context.fillText("Kernel properties: "+propertiesString,10,SVM.getHeight()-60),this.context.fillText("Support Vectors: "+numsupp+" / "+this.teacher.inputs.length,10,SVM.getHeight()-40),this.context.fillText("Complexity: "+this.teacher.getComplexity().toPrecision(2),10,SVM.getHeight()-20),this},Video.prototype.drawBubble=function(x,y,w,h,radius){var r=x+w,b=y+h;return this.context.beginPath(),this.context.strokeStyle="black",this.context.lineWidth=2,this.context.moveTo(x+radius,y),this.context.lineTo(x+radius/2,y-10),this.context.lineTo(x+2*radius,y),this.context.lineTo(r-radius,y),this.context.quadraticCurveTo(r,y,r,y+radius),this.context.lineTo(r,y+h-radius),this.context.quadraticCurveTo(r,b,r-radius,b),this.context.lineTo(x+radius,b),this.context.quadraticCurveTo(x,b,x,b-radius),this.context.lineTo(x,y+radius),this.context.quadraticCurveTo(x,y,x+radius,y),this.context.stroke(),this},Video.prototype.drawRect=function(x,y,w,h,stroke){return"undefined"==typeof stroke&&(stroke=!1),this.context.beginPath(),this.context.rect(x,y,w,h),this.context.closePath(),this.context.fill(),stroke&&this.context.stroke(),this},Video.prototype.drawCircle=function(x,y,r){return this.context.beginPath(),this.context.arc(x,y,r,0,2*Math.PI,!0),this.context.closePath(),this.context.stroke(),this.context.fill(),this},Video.prototype.snapShot=function(){return new Blob},Video.prototype.trace=function(){},Video}();Renderer.Video=Video}(SVM.Renderer||(SVM.Renderer={}));SVM.Renderer}(SVM||(SVM={})),define(["require","exports"],function(require,exports){function arrayPopulate(delta,value){var result;if(_.isString(value)||_.isNumber(value))result=value;else{if(!_.isFunction(value))throw"Passed value is not supported.";result=value.call(this,arguments)}return Array.apply(null,new Array(delta)).map(function(){return result},value)}exports.arrayPopulate=arrayPopulate});